$(document).ready(function(){
  $('body').on('click', '#add_family_btn', function(e){
  e.preventDefault();
  var family_type = $('#FamilyType').val();
  var add_registry_number = $('#add_registry_number').val();
  var add_record_number = $('#add_record_number').val();
  var add_family_record_date = $('#add_family_record_date').val();
  var add_auto_generated_id = $('#add_auto_generated_id').val();
  var is_closed = $('#is_closed').val();
  var Office_Id = $('#Office_Id').val();
  obj={FamilyType:family_type,Registrynumber:add_registry_number ,Recordnumber:add_record_number,FamilyRecordDate:add_family_record_date,Autogenerated_Id:add_auto_generated_id ,Is_Closed:is_closed ,OfficeId:Office_Id }
  $.post('/family/new_family',obj,function(todo){
    if(todo){
      window.location.href ="/family?msg=22";
    } else {
      window.location.href ="/family?msg=33";
    }
  }); 
});

$('#edit_family_record_date,#add_family_record_date').datetimepicker({
  useCurrent: false,
  viewMode: 'years',
  format: 'YYYY-MM-DD',
  locale: 'ar-sa'
});
  
$("[data-toggle=tooltip]").tooltip();
$("[name='family_type']").bootstrapSwitch();

jQuery.validator.addMethod("arabicLettersOnly", function(value, element) {
  return this.optional(element) || /^[أ-ي,ﻻ,' ',ء]+$/i.test(value);
}, "الرجاء ادخال حروف عربية فقط!");

/*----------- validate in add Family----------*/
$("#add_family_form").validate({
  rules:{
    FamilyType:{
      required: true,
      arabicLettersOnly: true,
    },
  },
  messages:{
    FamilyType:{
      required: "الرجاء ادخال اسم المنطقة!",
      arabicLettersOnly: "الرجاء ادخال حروف عربية فقط!",
    },
  },
  highlight: function(element) {
    $(element).closest('.row').addClass('has-error');
  },
  unhighlight: function(element) {
    $(element).closest('.row').removeClass('has-error');
  },
});

/*----------- validate in edit Family----------*/
$("#edit_family_form").validate({
  rules:{
    family_name:{
      required: true,
      arabicLettersOnly: true,
    },
  },
  messages:{
    family_name:{
      required: "الرجاء ادخال اسم المنطقة!",
      arabicLettersOnly: "الرجاء ادخال حروف عربية فقط!",
    },
  },
  highlight: function(element) {
    $(element).closest('.row').addClass('has-error').removeClass('has-success');
  },
  unhighlight: function(element) {
    $(element).closest('.row').removeClass('has-error').addClass('has-success');
  },
});

/*----------- validate in edit search----------*/
$("#search_family").validate({
  rules:{
    search_name:{
      required: true,
    },
  },
  messages:{
    search_name:{
      required: "",
    },
  },
  highlight: function(element) {
    $(element).closest('.input-group').addClass('has-error').removeClass('has-success');
  },
  unhighlight: function(element) {
    $(element).closest('.input-group').removeClass('has-error').addClass('has-success');
  },
  invalidHandler: function(event, validator) {
    var errors = validator.numberOfInvalids();
    if (errors) {
      custNotify("danger","خطأ","الرجاء ادخال كلمة البحث","ok-sign","bounceIn","bounceOut");
    }
  },
});

/*----------- view in modal Family----------*/
$('body').on('click', '.edit_btn', function(){
  var family_id = $(this).val(),
      registry_number= $('#br-'+family_id).data('registry_number');
      record_number= $('#br-'+family_id).data('record_number');
      family_record_date= $('#br-'+family_id).data('family_record_date');
      auto_generated_id= $('#br-'+family_id).data('auto_generated_id');
      is_closed= $('#br-'+family_id).data('is_closed');
      family_office= $('#br-'+family_id).data('officee');
      family_type= $('#br-'+family_id).data('family_type');
      office_name= $('#br-'+family_id).data('office_name');
      $('#FamilyTypeEdit').selectpicker('val',family_type);
      $('#edit_family_office').selectpicker('val',family_office);
      $('#edit_registry_number').val(registry_number);
      $('#edit_record_number').val(record_number);
      $('#edit_family_record_date').val(family_record_date);
      $('#edit_auto_generated_id').val(auto_generated_id);
  //$('#edit_is_closed').val(is_closed);
  $('#edit_is_closed').selectpicker('val',is_closed);
  $('#family_id_edit').val(family_id);
});

/*----------- Delete in modal Family----------*/
$('body').on('click', '.delete_btn', function(){
  var manucipality_id = $(this).val();
  console.log($(this).val());
  $("#family_id_delete").val($(this).val());
});

if($getMsg["msg"]==1){
  custNotify("success","نجاح","تم حذف العائلة بنجاح","ok-sign","bounceInDown","bounceOutUp");
  replaceUrl('/family');    
} else if ($getMsg["msg"]==2) {
  custNotify("danger","خطأ","لا يمكن حذف هذه العائ لاعتماد كيانات اخرى عليها","warning-sign","bounceIn","bounceOut");
  replaceUrl('/family');
} else if ($getMsg["msg"]==11) {
  custNotify("success","نجاح","لقد قمت بتعديل الحقول بنجاح","ok-sign","bounceInDown","bounceOut");
  replaceUrl('/family');
} else if ($getMsg["msg"]==22) {
  $('#add').modal('hide');
  custNotify("success","نجاح","لقد قمت بتعديل الحقول بنجاح","ok-sign","bounceInDown","bounceOut");
  replaceUrl('/family');
} else if ($getMsg["msg"]==33) {
   $('#add').modal('hide');
  custNotify("danger","خطأ","الرجاء تعبئة جميع البيانات بالطريقة الصحيحة","warning-sign","bounceIn","bounceOut");
  replaceUrl('/family');
}
});